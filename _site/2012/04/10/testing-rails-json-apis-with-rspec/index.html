<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="description" content="The Easyart Developers Blog">
<meta name="author" content="Easyart">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Testing Rails JSON APIs with RSpec | Easyart Developers</title>

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700">
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lt IE 9]>
<script src="/assets/js/html5.js"></script>
<![endif]-->

</head>

<body>

  <div class="global-header" role="banner">
    <h1><a href="/"><strong>Easyart</strong>Developers</a></h1>
  </div>

  <div class="content row">

    <section class="col-7">
      <div class="content-pri" role="main">

        <article class="hentry">
          <header>
            <h2>Testing Rails JSON APIs with RSpec</h2>
            <p class="updated">Posted on 10 April 2012 by Nick Boyce</p>
          </header>
          <p>I&rsquo;ve spent some time in the last couple of weeks taking the learnings from an early API prototype, and starting a new Rails application from scratch, complete with RSpec tests. Here are some notes on some of our tools and methodologies.</p>

<h3>Model specs</h3>

<p>We&rsquo;re overriding the as_json method in our models and we&rsquo;re using <a href="https://github.com/collectiveidea/json_spec">json_spec</a> to test the documents have the right structure.</p>

<script src="https://gist.github.com/2349770.js"> </script>


<h3>Request specs</h3>

<p>We have hundreds of lines of <a href="https://www.relishapp.com/rspec/rspec-rails/docs/request-specs/request-spec">request specs</a>, and no controller specs. Here is a simple example:</p>

<script src="https://gist.github.com/2349801.js"> </script>


<p>Because we&rsquo;re getting an actual HTTP payload back (in the response variable) we can inspect whatever part of it that&rsquo;s relevant to us. We know the structure of the responses should come back in a known format because we&rsquo;re testing the to_json method in the class specs. So it&rsquo;s just a matter of using JSON.parse on the response.body and testing it as a native Ruby object.</p>

<p>Of course, this means that we are trusting JSON.parse to behave reliably but that&rsquo;s an assumption worth making. If we were really pedantic, we could check that each object in the response array matches the expected structure:</p>

<script src="https://gist.github.com/2349803.js"> </script>


<p>Though I&rsquo;m not sure that&rsquo;s actually testing anything meaningful.</p>

<p>Another great advantage is that it makes refactoring simple. As far as the specs are concerned, a request to is the same whether the heavy lifting is done in the model or the controller. This really helped me recently when I moved a bunch of logic from the controller to the model as I could let the specs tell me which parts starting misbehaving.</p>

<p>Update: <a href="http://37signals.com/svn/posts/3159-testing-like-the-tsa">An interesting post by DHH about over-testing.</a></p>

        </article>
        <div id="disqus_thread"></div>
        <script>
          var disqus_shortname = 'easyartdevelopers';
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>    
    </section>

    <aside class="col-4 offset-1">
      <div class="content-sec" role="complementary">
        <div class="widget">
	<h3>Subscribe</h3>
  <form action="http://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('http://feedburner.google.com/fb/a/mailverify?uri=EasyartDevelopers', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
    <fieldset>
      <label for="email">Sign up for email updates:</label>
      <div>
        <input type="email" name="email">
        <input type="hidden" value="EasyartDevelopers" name="uri">
        <input type="hidden" name="loc" value="en_US">
        <button type="submit">Subscribe</button>
      </div>
    </fieldset>
  </form>
  <p><a href="http://feeds.feedburner.com/EasyartDevelopers">or subscribe to the RSS feed</a></p>
</div>

<div class="widget">
  <h3>About this blog</h3>
  <p>This is the blog of the developers at Easyart. We have a strong focus on user-centered design, test-driven development and emerging technologies.</p>
</div>

<div class="widget">
  <h3>Recent posts</h3>
  <ol>
    
    <li><a href="/2013/04/22/transitioning-to-bourbon">Transitioning to Bourbon</a></li>
    
    <li><a href="/2013/04/21/why-dont-other-industries-use-version-control">Why don't other industries use version control?</a></li>
    
    <li><a href="/2013/04/16/easyart-flavoured-agile">Easyart-flavoured agile</a></li>
    
    <li><a href="/2013/03/01/git-tricks">Git tricks</a></li>
    
    <li><a href="/2013/02/17/links-for-the-week">Links for the week</a></li>
    
    <li><a href="/2013/02/10/links-for-the-week">Links for the week</a></li>
    
    <li><a href="/2013/02/03/mobile-continuees-to-grow">Mobile continues to grow</a></li>
    
    <li><a href="/2013/01/26/links-this-week">Links This Week</a></li>
    
    <li><a href="/2013/01/25/personality-in-code">Personality in Code</a></li>
    
    <li><a href="/2013/01/21/front-end-performance-for-web-designers-and-front-end-developers">Front-end performance for web designers and front-end developers</a></li>
    
  </ol>
</div>
      </div>
    </aside>

  </div>

  <footer class="global-footer" role="contentinfo">
    <p>&copy; Copyright 2012 Easyart. All rights reserved.</p>
  </footer>

<script>

// Disqus comments
var disqus_shortname = 'easyartdevelopers';
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());

// Google analytics
var _gaq=[['_setAccount','UA-204511-23'],['_trackPageview']];
(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>